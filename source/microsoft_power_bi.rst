.. _data_power_bi:

Как загрузить данные в Microsoft Power BI
==========================================


* `Закажите данные <https://data.nextgis.com/ru/>`_ на интересующую Вас территорию, например, в формате GeoJSON.
* Дождитесь получения результата, скачайте, распакуйте архив с данными.
* Конвертируйте желаемый слой в формат **TopoJSON**. Для конвертации воспользуйтесь онлайн конвертером `MapShaper <https://mapshaper.org/>`_.
* В начале работы с Power BI необходимо подключить способ визуализации **Shaрe Map** (Карта фигур в российской версии). 
  Для этого в выпадающем меню **Файл** перейти последовательно в **Параметры и настройк** - **Параметры**. 
  Слева выбрать пункт **Предварительные версии возможностей** и справа отметить опцию **Визуальный элемент Карта фигур**.
  
.. figure:: _static/BI1.png
   :name: BI1
   :align: center
   :width: 16cm
   
   
* В основном окне Отчета слева выберите иконку способа визуализации **Карта фигур**. В окне Отчета появится окно для визуализации карты.

.. figure:: _static/BI2.png
   :name: BI2
   :align: center
   :width: 16cm
   
* Теперь необходимо добавить полученный ранее файл TopoJSON. Для этого в верхней панели последовательно выбрать **Получить данные** - **Другие** - **JSON** и 
  нажать внизу кнопку **Подключить**. В открывшемся окне выбрать ранее преобразованный файл и открыть его.
  
.. figure:: _static/BI3.png
   :name: BI3
   :align: center
   :width: 16cm
   
* После загрузки данных вы будете перенаправлены в окно редактора запросов. В котором  необходимо преобразовать загруженные данные для визуализации. 
  В таблице данных выбираете **список объектов** и дважды кликаете, чтобы открыть его.

.. figure:: _static/BI4.png
   :name: BI4
   :align: center
   :width: 16cm

* Выбранный список объектов нужно преобразовать в таблицу.

.. figure:: _static/BI5.png
   :name: BI5
   :align: center
   :width: 16cm


* В получившейся таблице проводите настройку элементов для визуализации. В верхней части таблицы нажимаете на **двойную стрелку**.
  В выпадающем списке выбираете **properties**. Нажимаете *ОК*
  
.. figure:: _static/BI6.png
   :name: BI6
   :align: center
   :width: 16cm
   
* В таблице свойств данных опять нажимаете на **двойную стрелку**. В выпадающем списке выбираете желаемые атрибуты для визуализации. Нажимаете *OК*

.. figure:: _static/BI7.png
   :name: BI7
   :align: center
   :width: 16cm


* На следующем шаге при желании можете переименовать название атрибута.
  После этого применяете и сохраняете все преобразования, нажимая кнопку в левом верхнем углу редактора запросов.

.. figure:: _static/BI8.png
   :name: BI8
   :align: center
   :width: 16cm
   
* Данные подготовлены. Теперь можете их визуализировать. В разделе **Поля** справа отмечаете выбранное и подготовленное на предыдущих этапах поле.
  Оно автоматически подгружается в подменю *Расположение* в разделе *Визуализация*. Но в окне визуализации подгружена карта по умолчанию.
  
.. figure:: _static/BI9.png
   :name: BI9
   :align: center
   :width: 16cm
   
* Вам необходимо подгрузить вашу собственную карту в формате TopoJSON. В разделе **Визуализация** заходите в подменю **Формат**. 
  Там в разделе **Фигура** нажимаете **Добавить сопоставление** и подгружаете подготовленную карту в формате TopoJSON

.. figure:: _static/BI0.png
   :name: BI10
   :align: center
   :width: 16cm


* Карта загружена.

.. figure:: _static/BI11.png
   :name: BI11
   :align: center
   :width: 16cm
